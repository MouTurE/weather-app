<body>
  <h1>Weather Tracker</h1>

  <form id="cityForm">
    <input type="text" id="cityInput" placeholder="Enter city name" required>
    <button type="submit">Fetch Weather</button>
  </form>

  <p id="message"></p>

  <table id="weatherTable">
    <thead>
      <tr>
        <th>City</th>
        <th>Temperature (Â°C)</th>
        <th>Description</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const form = document.getElementById('cityForm');
    const cityInput = document.getElementById('cityInput');
    const message = document.getElementById('message');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const city = cityInput.value.trim();
      if (!city) return;

      message.textContent = 'Fetching weather...';

      try {
        const res = await fetch('http://localhost:3001/fetch-weather', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ city })
        });

        const result = await res.text();
        message.textContent = result;
        cityInput.value = '';

        loadWeatherData();
      } catch (err) {
        message.textContent = 'Error fetching weather';
        console.error(err);
      }
    });

    function loadWeatherData() {
      fetch('http://localhost:3001/weather')
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector('#weatherTable tbody');
          tbody.innerHTML = '';
          data.forEach(row => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${row.city}</td>
              <td>${row.temperature}</td>
              <td>${row.description}</td>
              <td>${row.date}</td>
            `;
            tbody.appendChild(tr);
          });
        });
    }

    // Initial load
    loadWeatherData();
  </script>
</body>
